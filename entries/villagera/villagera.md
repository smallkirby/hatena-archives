# 村人Aなる者の話をしよう
ksnCTFというものを聞いたことがあるだろうか。とある人物によって作られた謎のサイトであり、CTFの問題が集められているというものである。僕はこのサイトの存在を2年前、大学2年生だった頃に初めて聞いた。CTFを始めようと思い、まずは何から手をつけるべきか知人に聞いたところ、このサイトのVillager Aという問題を勧められたのだ。全くの素人に勧めたということは、おそらくとても容易なものであろうと想像した。だが結果は散々であった。全く解けない。まず何をすればいいかわからない。何やってんのかわからない。これに挫折した僕は完全に拗ねてそれから数ヶ月間CTFについて全く調べなかった。
あれから2年。それなりに色々なコードを読んで、色々な問題を解いてきた。ユーザランドの問題は簡単なものであれば48h-CTFで時間内にpassできるようになった。kernel問題についてもごくごく初歩的なものならばゆっくりとではあるが解けるようになってきた。そんな今だからこそ、嘗ての宿敵、「Villager A」にリベンジしてみたいと思う。恐らくこれは並のkernel問題よりも難しい。kernel問題であっても今は大体何処を見るべきかとか、何処らへんが怪しいかとかは見ればなんとなく分かる。だがVillagerAは2年前何をすれば良いのかすら分からなかったのだ。辛くしんどい戦いになるだろう。だがこれは、嘗ての自分との決別の闘いだ。

# 難関1: まずはksnCTFを見つける
さあ、いざ行かん。だが次の瞬間僕は唖然とした。VillagerAを解くためには、まずVillagerAが何処にあるのかを探す必要があるのだ。ksnCTFというサイトにあるということは知人から聞いていた。だがそのサイトというものが何処にあるのかが分からない。ひとまずここで僕は東京駅を訪れた。これだけデカイ駅ならば探しているものが見つかるだろうと思ったのだ。だが、どの電光掲示板を見ても、路線図を見ても、ksnCTFという場所は見つからなかった。完全に路頭に迷ってしまったのだ。思い足取りを引きずって家へと帰った。それから2日が経ち、突破口を見つけた。どうやら、ksnCTFというのはインターネット上にあるらしい。Wikipediaによると、インターネットというのは以下のようなものらしい。
(Wikipediaより引用) 「インターネットとは、インターネット・プロトコル・スイートを使用し、複数のコンピュータネットワークを相互接続した、地球規模の情報通信網のことである。省略してネットとも呼ばれる。」
なるほど、地球のことらしい。だが、これでは情報量ゼロである。地球にあるというのは当然のことである。村人が地球外にいたら誰とも会話できなくて寂しいだろう。そこでもう少し調べてみると、どうやら「ぶらうざ」と呼ばれるものによって「いんたーねっと」というものにアクセスできるらしい。そしてぶらうざというものの中にksnCTFという村があって、その村に村人Aがいるらしい。ややこしくなってきた。だがこんなところでくじけるわけにはいかない。僕はChromeと呼ばれるぶらうざを開いた。これでksnctfと調べればいいらしい。だがその刹那、僕は気づいてしまった。どうやって調べれば良いんだ。ksnctfという文字を何処かに打つんだろうが、一体何処に打てば良いのか。ひとまず開発者ツールを開いてconsoleに「ksnctf」と打ってみた。
![](https://i.imgur.com/dngQEzA.png)
「ksnctf is not defined」と出た。どうやらここじゃないらしい。少し目線を上げると、虫眼鏡マークのボックスが見つかる。一瞬ここに打つのかと思った。だが、その右を見るとマイクのマークがついている。とすると、どうやらここではないと思う。そうは思いながらも、どうにでもなれと思い、この検索欄に「a」と入力してみた。刹那。
![](https://i.imgur.com/efxKaXD.png)
なんと、画面が切り替わり、検索結果のようなものが出現した。どうやら、ここに入力すると検索した結果が出力されるような仕組みになっているらしい。あとはここに「ksnctf」と入力すれば目的は達成されよう。だが、ここで我に返る。ふと自分のキーボードを見てみる。
![](https://i.imgur.com/emsAGT1.jpg)
愕然とした。なんと、キーボードの印字が全く無いのだ。これではどのキーを打てば「ksnctf」と書けるのかが全くわからない。一番下にある、異常に長いキーがスペースだろうということしか分からない。僕は近くのコンビニに行って白色の油性ペンを買い、ネットでキーボードの配列を調べてキーの一つ一つに印を付けた。これで好きな文字が打てる。勝ったも同然だ。先程の検索窓のようなところで「ksnctf」と入力する。
![](https://i.imgur.com/ujluyKb.png)
これだ。きっと、いや、確実にコレに違いない。リンクをクリックする。おっと、いきなり話を難しくしすぎた。「クリックする」というのは、マウスの右側の部分をカチッとする儀式のことを言う。刹那。
![](https://i.imgur.com/EEQujRz.png)
見つけた。確かにそこに、村人はいる。

# 難関2: ログインする
村人を見つけた瞬間、次の難関が立ちはだかる。画面の右上には、以下のように書いてあった。
![](https://i.imgur.com/6J21rku.png)
ログインというものをしなくてはいけないらしい。それも、with Twitterとあるから、Twitterというものでログインしなければいけないのだろう。ここで僕はTwitterとはなんなのかを調べた。Wikipediaによると以下のようなものらしい。
(Wikipediaより引用)「Twitter（ツイッター）は、アメリカ合衆国・カリフォルニア州サンフランシスコに本社を置くTwitter, Inc.のソーシャル・ネットワーキング・サービス (SNS)（情報サービス）。」
サンフランシスコのことらしい。どうやら鳥のことではないようだ。僕は右手に持っていた手羽先を取り敢えず更に置いた。だが、これもまた情報量はゼロに近い。村人がサンフランシスコに居るということしか分からなかった。
ここで僕はさらなる情報を集めるためにTwitterでTwitterとは何かを調べた。
![](https://i.imgur.com/Ea6nYql.png)
どうやら、Twitterというのは人々が情報を吐いたり飲み込んだりする場所らしい。そこでは、人々がTweetという投稿を好きに書き込んで、また他の人が投稿したTweetを見ることができるという仕組みになっているらしい。そしてこの鳥を生贄に捧げると、ksnctfにログインできるらしい。僕は取り敢えずTwitterアカウントを作ることにした。刹那。なんと自分は知らぬ間にアカウントを持っていたらしい。よって、この鳥をksnctfに戻って捧げたところ、以下のようになった。
![](https://i.imgur.com/oBm6lnp.png)
ログインができたようだ。第二の難関、突破。

# 難関3: 何をすれば良いのかわからない
さて、いよいよ因縁の宿敵との対面である。ここでもやはり、すぐに呆気にとられることになる。村人と対面すると、以下のような謎の文字列が書かれていた。
![](https://i.imgur.com/0oNSmPy.png)
何を言っているのか、さっぱり分からない。取り敢えず全てコピペしてターミナルに貼ってみることにした。
![](https://i.imgur.com/rGa4paC.png)
どうやら違うらしい。30分間悩んだ末、原因は些細なことだと分かった。最初の一文字の「s」が抜けていたのだ。sを頭につけてもう一度やってみる。
![](https://i.imgur.com/HZV4Tf8.png)
どうやらできているっぽい。何がどうなっているのかはわからないが、取り敢えず村人の住む村に入ることはできたようだ。ここで、q4というファイルがあることが分かる。いや、実は40分間経つまで気づかなかったのだが。取り敢えず、苦労の末このファイルを見つけた。取り敢えずこのファイルをローカルに落としてみることにする。
![](https://i.imgur.com/PeEef1v.png)
よし、あとはどうやらこのq4とかいうファイルを見てみればいいらしい。

$ sh ~/snipet/exploit/init_ghidra.sh ghidra ./q4 -o -l -c
[*] Using /home/wataru/Documents/ksnctf/villagera/test as project path
[+] Logging the anylisis at /home/wataru/Documents/ksnctf/villagera/anylisis_log.txt
[+] Enabled common checks of -postScript preanalysis_headless.py @ /home/wataru/snipet/exploit/
** IN MEMORY **
[!] FOUND!: flag
[!] FOUND!: flag
** IN DECOMPILED CODE **
sha256: 24844b5455e15b60a4415ecfc5fe06619143f636c0cbc6793aed4f4402a5e77e
compiler_spec: gcc
import_api_count: 9
language: x86:LE:32:default
defined_data_count: 0
name: q4
function_count: 36
[+] Created project /home/wataru/Documents/ksnctf/villagera/ghidra and imported ./q4
[+] Opening Ghidra...

上の結果から、flagという文字列も見える。flagが何を意味しているのかはわからないが、わざわざ書いてあるということは何か大事なものなのだろう。EVAのチケットとか。


# exploit
問題を解くパートは非本質部分だと思うので省略します。

# 難関4: flagが取れたが、これをどうすれば良いのかわからない。あと村人が何処に居るかわからない
flagというものは取れた。
![](https://i.imgur.com/gvcbHEe.png)
だが、これを一体どうすればいいというのだ。サイトには以下のようにある。
(ksnctfより引用)「コンピュータセキュリティに関する問題を出題します。 各問題からFLAG_123456xyzという形式の答え（flag）を探してください。」
flagは探し出した。だが、その先はどうすればいい。

ここで3時間ほど悩んだが、結局どうすればいいか分からなかった。どうやら、自分にはまだ早かったみたいだ。取り敢えず今はタンスの春服の下らへんにしまってある。春が来て、もしまだやる意思があるのならば、もう一度挑戦してみようと思う。




10年前の自分は、こんな意味分からんことしてるとは思わないだろうな。



